# Example schema for collecting deployment environment information
# Used by setup-project-domain-vendor for Deploy Environments domain

schema:
  environments:
    type: array
    required: true
    items:
      type: object
      properties:
        name:
          type: string
          required: true
          description: "Environment name"
        type:
          type: enum
          required: true
          options: ["local", "development", "staging", "production"]
    description: "Deployment environments for this project"
    example:
      - { name: "local", type: "local" }
      - { name: "stable", type: "staging" }
      - { name: "prod", type: "production" }
    presets:
      - label: "Local only"
        value: [{ name: "local", type: "local" }]
      - label: "Local + Production"
        value:
          - { name: "local", type: "local" }
          - { name: "production", type: "production" }
      - label: "Local + Staging + Production"
        value:
          - { name: "local", type: "local" }
          - { name: "staging", type: "staging" }
          - { name: "production", type: "production" }

  # For each non-local environment, collect access details
  access_details:
    type: array
    required: false
    items:
      type: object
      properties:
        environment:
          type: string
          description: "Environment name (from environments list)"
        has_access:
          type: boolean
          description: "Do you have access to this environment?"
        access_method:
          type: enum
          options: ["ssh", "kubectl", "aws", "gcp", "azure", "other"]
          description: "How do you access this environment?"
          condition: "has_access == true"
        ssh_host:
          type: string
          description: "SSH hostname or IP"
          condition: "access_method == 'ssh'"
        ssh_user:
          type: string
          default: "deploy"
          description: "SSH username"
          condition: "access_method == 'ssh'"
        ssh_port:
          type: number
          default: 22
          description: "SSH port"
          condition: "access_method == 'ssh'"
        ssh_key:
          type: string
          description: "Path to SSH private key"
          example: "~/.ssh/id_rsa"
          condition: "access_method == 'ssh'"
    description: "Access details for each non-local environment"
    condition: "environments contains non-local"

  verify_access:
    type: boolean
    required: false
    default: true
    description: "Would you like to verify SSH connectivity now?"
    condition: "access_details contains ssh"

context: "Configuring deployment environments and verifying access"

# Post-collection actions
actions:
  - condition: "verify_access == true"
    action: |
      For each environment with SSH access:
      ```bash
      ssh -o ConnectTimeout=5 -o BatchMode=yes {ssh_user}@{ssh_host} -p {ssh_port} -i {ssh_key} "echo 'Connection successful'"
      ```
      Report success/failure for each environment.
